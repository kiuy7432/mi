<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>資料請求</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&family=Cinzel:wght@500;600&display=swap" rel="stylesheet">

  <style>
    :root{
      --gold:#c9a24d;
      --gold2:#a8853a;
      --line:#e6e6e6;
      --muted:#555;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      background:#fff;
      font-family:"Noto Sans JP", system-ui, -apple-system, "Segoe UI", Roboto;
      color:#111;
    }
    .wrap{max-width:640px;margin:60px auto;padding:0 16px;}
    .card{
      background:#fff;
      border:1px solid var(--line);
      border-radius:18px;
      padding:40px 32px;
      box-shadow:0 24px 48px rgba(0,0,0,.08);
    }
    h1{
      font-family:"Cinzel", serif;
      letter-spacing:.08em;
      text-align:center;
      margin:0 0 16px;
      font-size:28px;
    }
    .lead{
      text-align:center;
      font-size:14px;
      line-height:1.8;
      color:var(--muted);
      margin:0 0 36px;
    }
    .field{margin-bottom:22px;}
    label.lbl{
      font-weight:700;
      font-size:13px;
      display:block;
      margin:0 0 8px;
    }
    .req{
      margin-left:6px;
      padding:2px 8px;
      font-size:11px;
      border-radius:999px;
      border:1px solid var(--gold);
      color:var(--gold2);
      font-weight:700;
      vertical-align:middle;
    }

    /* ✅ ここが崩れ修正ポイント：テキスト系だけ width:100% */
    input[type="text"],
    input[type="email"],
    input[type="url"],
    textarea{
      width:100%;
      border-radius:12px;
      border:1px solid #d6d6d6;
      padding:12px 14px;
      font-size:16px;
      background:#fff;
    }
    textarea{min-height:120px;resize:vertical;}

    input[type="text"]:focus,
    input[type="email"]:focus,
    input[type="url"]:focus,
    textarea:focus{
      outline:none;
      border-color:var(--gold);
      box-shadow:0 0 0 3px rgba(201,162,77,.15);
    }

    .checks{
      display:grid;
      gap:10px;
    }
    .check{
      display:flex;
      align-items:flex-start;
      gap:10px;
      padding:12px 14px;
      border:1px solid #e1e1e1;
      border-radius:12px;
      background:#fafafa;
      font-size:14px;
      line-height:1.5;
      cursor:pointer;
      user-select:none;
    }
    /* ✅ checkboxは width:auto を明示 */
    .check input[type="checkbox"]{
      width:auto;
      margin:2px 0 0;
      accent-color:var(--gold);
      flex:0 0 auto;
    }
    .check span{
      display:block;
      flex:1 1 auto;
    }

    button{
      width:100%;
      border-radius:14px;
      border:1px solid var(--gold);
      background:linear-gradient(180deg,var(--gold),var(--gold2));
      color:#fff;
      font-size:16px;
      font-weight:700;
      padding:14px;
      cursor:pointer;
    }
    button:disabled{
      opacity:.55;
      cursor:not-allowed;
    }

    .done, .limit{
      display:none;
      margin-top:18px;
      padding:14px;
      border-radius:12px;
      text-align:center;
      font-weight:700;
      line-height:1.6;
    }
    .done{
      background:#f4fbf7;
      border:1px solid #cde6d8;
      color:#245c3b;
    }
    .limit{
      background:#fff5f5;
      border:1px solid #f1caca;
      color:#8b2e2e;
    }
    .subnote{
      margin-top:8px;
      font-size:12px;
      color:#777;
      text-align:center;
    }

    @media (max-width:480px){
      .wrap{margin:36px auto;}
      .card{padding:28px 18px;border-radius:16px;}
      h1{font-size:24px;}
    }
  </style>
</head>

<body>
<div class="wrap">
  <div class="card">
    <h1>資料請求</h1>

    <p class="lead">
      下記内容をご入力の上、送信をお願いします。<br>
      ※こちらは案内代行のため、資料はサービス提供元から送付します。
    </p>

    <form id="requestForm"
      action="https://docs.google.com/forms/u/0/d/e/1FAIpQLSetPvbu4S7A7JnHhOIxDGZ-SWgOdadjo96icYH2jrHRbrg6YA/formResponse"
      method="POST"
      target="hidden_iframe"
    >
      <div class="field">
        <label class="lbl">社名<span class="req">必須</span></label>
        <input type="text" name="entry.366430915" required>
      </div>

      <div class="field">
        <label class="lbl">メールアドレス<span class="req">必須</span></label>
        <input type="email" name="entry.1282123632" required>
      </div>

      <div class="field">
        <label class="lbl">ホームページURL<span class="req">必須</span></label>
        <input type="url" name="entry.1341512877" required>
      </div>

      <div class="field">
        <label class="lbl">検討している内容</label>

        <!-- Googleフォームのチェックボックス仕様対策（sentinel） -->
        <input type="hidden" name="entry.2091305958_sentinel" value="">

        <div class="checks">
          <label class="check">
            <input type="checkbox" name="entry.2091305958" value="動画制作">
            <span>動画制作</span>
          </label>
          <label class="check">
            <input type="checkbox" name="entry.2091305958" value="ホームページ制作">
            <span>ホームページ制作</span>
          </label>
          <label class="check">
            <input type="checkbox" name="entry.2091305958" value="ランディングページ制作">
            <span>ランディングページ制作</span>
          </label>
          <label class="check">
            <input type="checkbox" name="entry.2091305958" value="採用サイト制作">
            <span>採用サイト制作</span>
          </label>
          <label class="check">
            <input type="checkbox" name="entry.2091305958" value="その他">
            <span>その他</span>
          </label>
        </div>
      </div>

      <div class="field">
        <label class="lbl">ご質問・お問い合わせ</label>
        <textarea name="entry.1754680726"></textarea>
      </div>

      <button type="submit" id="submitBtn">送信する</button>
      <div class="subnote" id="remainNote"></div>

      <div class="done" id="done">送信しました。ありがとうございました。</div>
      <div class="limit" id="limit">
      エラー
      </div>
    </form>

    <iframe name="hidden_iframe" id="hidden_iframe" style="display:none;"></iframe>
  </div>
</div>

<script>
  // 右クリック禁止
  document.addEventListener('contextmenu', e => e.preventDefault(), { passive:false });

  const MAX_SUBMIT = 3;
  const WINDOW_MS = 24 * 60 * 60 * 1000; // 24h
  const KEY = 'request_form_submit_timestamps_v1';

  const form = document.getElementById('requestForm');
  const done = document.getElementById('done');
  const limit = document.getElementById('limit');
  const iframe = document.getElementById('hidden_iframe');
  const submitBtn = document.getElementById('submitBtn');
  const remainNote = document.getElementById('remainNote');

  function loadTimestamps(){
    try{
      const raw = localStorage.getItem(KEY);
      const arr = raw ? JSON.parse(raw) : [];
      return Array.isArray(arr) ? arr.map(Number).filter(n => Number.isFinite(n)) : [];
    }catch(e){
      return [];
    }
  }

  function saveTimestamps(arr){
    localStorage.setItem(KEY, JSON.stringify(arr));
  }

  function purgeOld(arr){
    const now = Date.now();
    return arr.filter(ts => now - ts < WINDOW_MS);
  }

  function updateRemainUI(){
    const nowArr = purgeOld(loadTimestamps());
    saveTimestamps(nowArr);

    const remain = Math.max(0, MAX_SUBMIT - nowArr.length);
    if (remain > 0) {
      remainNote.textContent = ``;
      limit.style.display = 'none';
      submitBtn.disabled = false;
    } else {
      remainNote.textContent = ``;
      limit.style.display = 'block';
      submitBtn.disabled = true; // ボタンも無効化
    }
  }

  updateRemainUI();

  form.addEventListener('submit', function(e){
    const nowArr = purgeOld(loadTimestamps());

    if (nowArr.length >= MAX_SUBMIT) {
      e.preventDefault();
      limit.style.display = 'block';
      submitBtn.disabled = true;
      updateRemainUI();
      return;
    }

    // 送信カウント（この送信分を追加）
    nowArr.push(Date.now());
    saveTimestamps(nowArr);

    window._submitted = true;
    updateRemainUI();
  });

  iframe.addEventListener('load', function(){
    if (!window._submitted) return;
    window._submitted = false;
    done.style.display = 'block';
  });

  // 別タブ等でlocalStorageが変わった場合も反映
  window.addEventListener('storage', function(ev){
    if (ev.key === KEY) updateRemainUI();
  });
</script>
</body>
</html>
